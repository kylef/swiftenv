BRANCH="swift-3.1-branch"
fetch_git swift $BRANCH swift
fetch_git swift-llvm $BRANCH llvm
fetch_git swift-clang $BRANCH clang
fetch_git swift-lldb $BRANCH lldb
fetch_git swift-cmark $BRANCH cmark
fetch_git swift-llbuild $BRANCH llbuild
fetch_git swift-package-manager $BRANCH swiftpm
fetch_git swift-compiler-rt $BRANCH compiler-rt
fetch_git swift-corelibs-xctest $BRANCH swift-corelibs-xctest
fetch_git swift-corelibs-foundation $BRANCH swift-corelibs-foundation
fetch_git swift-corelibs-libdispatch $BRANCH swift-corelibs-libdispatch

cat > $TMP/swift-build-presets.ini << "EOF"
[preset: mixin_lightweight_assertions]
assertions
no-swift-stdlib-assertions
dash-dash
swift-enable-ast-verifier=0

[preset: swiftenv]
mixin-preset=mixin_lightweight_assertions

llbuild
swiftpm
xctest
lldb
release
foundation
libdispatch
dash-dash
build-swift-static-stdlib
build-swift-static-sdk-overlay
build-swift-stdlib-unittest-extra
swift-install-components=autolink-driver;compiler;clang-builtin-headers;stdlib;swift-remote-mirror;sdk-overlay;license
install-swift
install-lldb
install-llbuild
install-swiftpm
install-xctest
install-foundation
install-libdispatch
install-prefix=/usr
install-destdir=%(install_destdir)s
reconfigure
EOF

build_swift --preset=file=swift/utils/build-presets.ini --preset-file=$TMP/swift-build-presets.ini --preset=swiftenv
