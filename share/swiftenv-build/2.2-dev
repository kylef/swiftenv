BRANCH="swift-2.2-branch"
fetch_git swift $BRANCH swift
fetch_git swift-llvm $BRANCH llvm
fetch_git swift-clang $BRANCH clang
fetch_git swift-lldb $BRANCH lldb
fetch_git swift-cmark $BRANCH cmark

cat > $TMP/swift-build-presets.ini << "EOF"
[preset: mixin_lightweight_assertions]
assertions
no-swift-stdlib-assertions
dash-dash
swift-enable-ast-verifier=0

[preset: swiftenv]
mixin-preset=mixin_lightweight_assertions

lldb
release
dash-dash
build-swift-static-stdlib=1
skip-test-lldb=1
swift-install-components=compiler;clang-builtin-headers;stdlib;sdk-overlay;license
install-swift
install-lldb
install-prefix=/usr
install-destdir=%(install_destdir)s
reconfigure
EOF

build_swift --preset=file=swift/utils/build-presets.ini --preset-file=$TMP/swift-build-presets.ini --preset=swiftenv
