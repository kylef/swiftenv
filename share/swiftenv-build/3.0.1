TAG="swift-3.0.1-RELEASE"
fetch_git swift $TAG swift
fetch_git swift-llvm $TAG llvm
fetch_git swift-clang $TAG clang
fetch_git swift-lldb $TAG lldb
fetch_git swift-cmark $TAG cmark
fetch_git swift-llbuild $TAG llbuild
fetch_git swift-package-manager $TAG swiftpm
fetch_git swift-compiler-rt $TAG compiler-rt
fetch_git swift-corelibs-xctest $TAG swift-corelibs-xctest
fetch_git swift-corelibs-foundation $TAG swift-corelibs-foundation
fetch_git swift-corelibs-libdispatch $TAG swift-corelibs-libdispatch

cat > $TMP/swift-build-presets.ini << "EOF"
[preset: mixin_lightweight_assertions]
assertions
no-swift-stdlib-assertions
dash-dash
swift-enable-ast-verifier=0

[preset: swiftenv]
mixin-preset=mixin_lightweight_assertions

llbuild
swiftpm
xctest
lldb
release
foundation
libdispatch
dash-dash
build-swift-static-stdlib
build-swift-static-sdk-overlay
build-swift-stdlib-unittest-extra
swift-install-components=autolink-driver;compiler;clang-builtin-headers;stdlib;swift-remote-mirror;sdk-overlay;license
install-swift
install-lldb
install-llbuild
install-swiftpm
install-xctest
install-foundation
install-libdispatch
install-prefix=/usr
install-destdir=%(install_destdir)s
reconfigure
EOF

build_swift --preset=file=swift/utils/build-presets.ini --preset-file=$TMP/swift-build-presets.ini --preset=swiftenv
